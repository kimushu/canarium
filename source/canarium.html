<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">// Generated by CoffeeScript 1.9.1

<span id='Canarium'>/**
</span>@class Canarium
PERIDOT通信クラス
 */

/*
  通信レイヤー

  ********* Host (Chrome) *********         ********** PERIDOT board **********

  +-----+ +-------------+ +-------+         +-------------------+   +---------+
  | App | | File System | | Sock  |         |  Nios II Program  |   |   ...   |
  +-----+ +-------------+ +-------+         +-------------------+   +---------+
     |           |            |                       | &lt;- IORD/IOWR     |
  +-------------------------------+         +-------------------+   +---------+
  |    Canarium.VirtualChannel    |         |    PERIDOT SWI    |   |   ...   |
  +-------------------------------+         +-------------------+   +---------+
        JS I/F -&gt; |                                   | &lt;- avm           |
  +-------------------------------+         +-------------------+   +---------+
  |      Canarium.AvmPackets      |         | Transaction Conv. |   | future* |
  +-------------------------------+         +-------------------+   +---------+
        JS I/F -&gt; |                               ch0 | &lt;- avs,packet -&gt; | chX
  +-------------------------------+         +---------------------------------+
  |      Canarium.AvsPackets      |         |    Bytes/Packets Conv. &amp; Mux    |
  +-------------------------------+         +---------------------------------+
        JS I/F -&gt; |                                          | &lt;- SCIF(avs,bytes)
  +-------------------------------+         +---------------------------------+
  |       Canarium.BaseComm       |         |           CPLD v1.1             |
  +-------------------------------+         +---------------------------------+
    Chrome I/F -&gt; |                                          | &lt;- FIFO I/F
  +-------------------------------+         +---------------------------------+
  |         chrome.serial         |---USB---|          FTDI FT240X            |
  +-------------------------------+         +---------------------------------+
 */
var Canarium;

Canarium = (function() {
  var AvmAccessor, AvsPacket, Channel, I2CAccessor;

  function Canarium() {}


<span id='Canarium-property-version'>  /**
</span>  @property {string}
    ライブラリのバージョン
   */

  Canarium.prototype.version = &quot;0.9.9&quot;;


<span id='Canarium-property-boardInfo'>  /**
</span>  @property {Object}  boardInfo
    接続しているボードの情報
  
  @property {string}  boardInfo.id
    &#39;J72A&#39; (J-7SYSTEM Works / PERIDOT board)
  
  @property {string}  boardInfo.serialcode
    &#39;xxxxxx-yyyyyy-zzzzzz&#39;
   */

  Canarium.prototype.boardInfo = null;


<span id='Canarium-property-serialBitrate'>  /**
</span>  @property {number}
    デフォルトのビットレート
   */

  Canarium.prototype.serialBitrate = 115200;


<span id='Canarium-property-channels'>  /**
</span>  @property {Canarium.Channel[]}
    チャネル[0～255]
  @readonly
   */

  Canarium.prototype.channels = null;


<span id='Canarium-property-avm'>  /**
</span>  @property {Canarium.AvmAccessor}
    AvalonMMアクセス制御クラスのインスタンス
  @readonly
   */

  Canarium.prototype.avm = null;


<span id='Canarium-property-i2c'>  /**
</span>  @property {Canarium.I2CAccessor}
    I2C通信制御クラスのインスタンス
  @readonly
   */

  Canarium.prototype.i2c = null;


<span id='Canarium-property-_connectionId'>  /**
</span>  @property {number}
    chrome.serialのコネクションID
  @private
   */

  Canarium.prototype._connectionId = null;


<span id='Canarium-method-_err'>  /**
</span>  @method
    開発者向けのエラーログを出力する
  @param {Object} data
    出力メッセージ等のデータ(型は自由)
  @return {void}
  @private
   */

  Canarium.prototype._err = function(data) {
    console.log({
      &quot;error&quot;: data,
      &quot;stack&quot;: new Error().stack,
      &quot;canarium&quot;: this
    });
  };


<span id='Canarium-method-open'>  /**
</span>  @method
    PERIDOTデバイスポートのオープン
  @param {string} portname
    接続するポート名(chrome.serial.getDevicesのports[].pathを指定)
  @param {function(boolean):void} callback
    コールバック関数
  @return {void}
   */

  Canarium.prototype.open = function(portname, callback) {
    if (this.connected) {
      callback(false);
      return;
    }
    this.boardInfo = null;
  };


<span id='Canarium-method-close'>  /**
</span>  @method
    PERIDOTデバイスポートのクローズ
  @param {function(boolean):void} callback
    コールバック関数
  @return {void}
   */

  Canarium.prototype.close = function(callback) {};


<span id='Canarium-method-config'>  /**
</span>  @method
    ボードのFPGAコンフィグレーション
  @param {Object/null}  boardInfo
    ボード情報(ボードIDやシリアル番号を限定したい場合)
  @param {string/null}  boardInfo.id
    ボードID
  @param {string/null}  boardInfo.serialCode
    シリアル番号
  @param {ArrayBuffer}  rbfdata
    rbfまたはrpdのデータ
  @param {function(boolean):void} callback
    コールバック関数
  @return {void}
   */

  Canarium.prototype.config = function(boardInfo, rbfdata, callback) {};


<span id='Canarium-method-reset'>  /**
</span>  @method
    ボードのマニュアルリセット
  @param {function(boolean):void} callback
    コールバック関数
  @return {void}
   */

  Canarium.prototype.reset = function(callback) {};


<span id='Canarium-method-getinfo'>  /**
</span>  @method
    ボード情報の取得
  @param {function(boolean):void} callback
    コールバック関数
  @return {void}
   */

  Canarium.prototype.getinfo = function(callback) {
    if (!this.connected || this.getinfoBarrier) {
      callback(false);
      return;
    }
  };


<span id='Canarium-method-_transpacket'>  /**
</span>  @method
    AvalonSTパケットの送受信
  @param {Number} channel
    チャネル番号(CPLDv1.1時点では0固定)
  @param {ArrayBuffer}  writedata
    書き込みデータ
  @param {Object} options
    パケット送信オプション
  @param {function(boolean,ArrayBuffer):void} callback
    コールバック関数
  @return {void}
  @private
   */

  Canarium.prototype._transpacket = function(channel, writedata, options, callback) {
    this._packetsend(channel, writedata, function(result) {
      if (!result) {
        return callback(false, null);
      }
    });
    this._packetrecv(channel, callback);
  };


<span id='Canarium-method-_packetsend'>  /**
</span>  @method
    AvalonSTパケットの送信
   */

  Canarium.prototype._packetsend = function(channel, data, callback) {};


<span id='Canarium-AvsPacket'>  /**
</span>  @class Canarium.AvsPacket
  Avalon-STパケットクラス
   */

  AvsPacket = (function() {

<span id='AvsPacket'>    /**
</span>     */
    function AvsPacket() {}

    return AvsPacket;

  })();


<span id='Canarium-Channel'>  /**
</span>  @class Canarium.Channel
  仮想通信ポート(チャネル)クラス
   */

  Channel = (function() {

<span id='Canarium-Channel-property-_canarium'>    /**
</span>    @property {Canarium}
      オーナーのCanariumクラスインスタンス
    @readonly
    @private
     */
    Channel.prototype._canarium = null;


<span id='Canarium-Channel-property-index'>    /**
</span>    @property {Number}
      チャネル番号(0～255)
    @readonly
     */

    Channel.prototype.index = null;


<span id='Canarium-Channel-method-Channel'>    /**
</span>    @method
      コンストラクタ
    @param {Canarium} canarium
      オーナーのCanariumクラスインスタンス
    @param {Number}   index
      チャネル番号(0～255)
    @private
     */

    function Channel(_canarium, index) {
      this._canarium = _canarium;
      this.index = index;
    }


<span id='Canarium-Channel-method-send'>    /**
</span>    @method
      非同期データ送信要求をキューに入れます。
      複数の送信要求をキューに入れることができます。送信順序はキューに入れた順です。
    @param {Number[]/ArrayBuffer/String}  senddata
      送信するデータ
    @param {Function}     successCallback
      送信成功時のコールバック
    @param {Number/null}  [timeout]
      タイムアウト時間[ms] (省略時 or nullは無限待ち)
    @param {Function}     [errorCallback]
      エラー発生時のコールバック
    @return {boolean} true:キュー追加成功(送信成功とは異なる)、false:失敗
     */

    Channel.prototype.send = function(senddata, successCallback, timeout, errorCallback) {
      return null;
    };


<span id='Canarium-Channel-method-recv'>    /**
</span>    @method
      データ受信イベントを登録します。一度受信するか失敗が確定すると解除されます。
      複数の受信待ちを同時に登録することはできません。
    @param {&quot;arraybuffer&quot;/&quot;string&quot;} readtype
      受信したデータを受け取る際のデータ型
    @param {Function}     successCallback
      受信成功時のコールバック (function(readdata))
    @param {Number/null}  [timeout]
      タイムアウト時間[ms] (省略時 or nullは無限待ち)
    @param {Function}     [errorCallback]
      エラー発生時のコールバック
    @return {boolean} true:登録成功(受信成功とは異なる)、false:失敗
     */

    Channel.prototype.recv = function(readtype, successCallback, timeout, errorCallback) {
      return null;
    };

    return Channel;

  })();


<span id='Canarium-AvmAccessor'>  /**
</span>  @class Canarium.AvmAccessor
  Avalon-MMアクセス制御クラス
   */

  AvmAccessor = (function() {

<span id='Canarium-AvmAccessor-property-_canarium'>    /**
</span>    @property {Canarium}
      オーナーのCanariumクラスインスタンス
    @readonly
    @private
     */
    AvmAccessor.prototype._canarium = null;


<span id='Canarium-AvmAccessor-method-option'>    /**
</span>    @method
      AvalonMM通信オプション指定
    @param {Object}   option
      通信オプション
    @param {boolean}  option.fastAcknowledge
      即時応答モードの有効/無効
    @param {function(boolean):void} callback
      コールバック関数
    @return {void}
     */

    AvmAccessor.prototype.option = function(option, callback) {};


<span id='Canarium-AvmAccessor-method-iord'>    /**
</span>    @method
      AvalonMMペリフェラルリード(IORD)
    @param {Number} address
      読み込み元アドレス(バイト単位、ただし4バイトの倍数に切り捨てられる)
    @param {Number} offset
      オフセット(32-bitワード単位)
    @param {function(boolean, Number):void} callback
      コールバック関数
    @return {void}
     */

    AvmAccessor.prototype.iord = function(address, offset, callback) {
      var regaddr;
      regaddr = (address &amp; (~3)) + (offset &lt;&lt; 2);
      this._transaction(0x10, 4, regaddr, function(result, response) {
        var readdata;
        return readdata = null;
      });
    };


<span id='Canarium-AvmAccessor-method-iowr'>    /**
</span>    @method
      AvalonMMペリフェラルライト(IOWR)
    @param {Number} address
      書き込み先アドレス(バイト単位、ただし4バイトの倍数に切り捨てられる)
    @param {Number} offset
      オフセット(32-bitワード単位)
    @param {Number} writedata
      書き込みデータ(32-bit符号無し整数)
    @param {function(boolean):void} callback
      コールバック関数
    @return {void}
     */

    AvmAccessor.prototype.iowr = function(address, offset, writedata, callback) {
      return void 0;
    };


<span id='Canarium-AvmAccessor-method-read'>    /**
</span>    @method
      AvalonMMメモリリード(IORD_DIRECT)
    @param {Number} address
      読み込み元アドレス(バイト単位)
    @param {Number} bytenum
      読み込みサイズ(バイト単位、最大65535バイト)
    @param {function(boolean,ArrayBuffer):void}  callback
      コールバック関数
    @return {void}
     */

    AvmAccessor.prototype.read = function(address, bytenum, callback) {
      return void 0;
    };


<span id='Canarium-AvmAccessor-method-write'>    /**
</span>    @method
      AvalonMMメモリライト(IOWR_DIRECT)
    @param {Number} address
      書き込み先アドレス(バイト単位)
    @param {ArrayBuffer}  writedata
      書き込みデータ(最大65535バイト)
    @param {function(boolean):void} callback
      コールバック関数
    @return {void}
     */

    AvmAccessor.prototype.write = function(address, writedata, callback) {
      return void 0;
    };


<span id='Canarium-AvmAccessor-method-AvmAccessor'>    /**
</span>    @method
      コンストラクタ
    @param {Canarium} _canarium
      オーナーのCanariumクラスインスタンス
    @private
     */

    function AvmAccessor(_canarium) {
      this._canarium = _canarium;
    }

    return AvmAccessor;

  })();


<span id='Canarium-I2CAccessor'>  /**
</span>  @class Canarium.I2CAccessor
  I2C通信制御クラス
   */

  I2CAccessor = (function() {

<span id='Canarium-I2CAccessor-property-_canarium'>    /**
</span>    @property {Canarium}
      オーナーのCanariumクラスインスタンス
    @readonly
    @private
     */
    I2CAccessor.prototype._canarium = null;


<span id='Canarium-I2CAccessor-method-start'>    /**
</span>    @method
      スタートコンディションの送信
    @param {function(boolean):void} callback
      コールバック関数
    @return {void}
     */

    I2CAccessor.prototype.start = function(callback) {
      return void 0;
    };


<span id='Canarium-I2CAccessor-method-stop'>    /**
</span>    @method
      ストップコンディションの送信
      (必ずSCL=&#39;L&#39;が先行しているものとする)
    @param {function(boolean):void} callback
      コールバック関数
    @return {void}
     */

    I2CAccessor.prototype.stop = function(callback) {
      return void 0;
    };


<span id='Canarium-I2CAccessor-method-read'>    /**
</span>    @method
      バイトリード
      (必ずSCL=&#39;L&#39;が先行しているものとする)
    @param {boolean}  ack
      ACK返却の有無(true:ACK, false:NAK)
    @param {function(boolean, Number):void} callback
      コールバック関数
      function(boolean:通信成否, Number:読み込みデータ(0～255))
    @return {void}
     */

    I2CAccessor.prototype.read = function(ack, callback) {
      return void 0;
    };


<span id='Canarium-I2CAccessor-method-write'>    /**
</span>    @method
      バイトライト
      (必ずSCL=&#39;L&#39;が先行しているものとする)
    @param {boolean}  writebyte
      書き込むデータ(0～255)
    @param {function(boolean, boolean):void} callback
      コールバック関数
      function(boolean:通信成否, boolean:ACK受信有無)
    @return {void}
     */

    I2CAccessor.prototype.write = function(writebyte, callback) {
      return void 0;
    };


<span id='Canarium-I2CAccessor-method-I2CAccessor'>    /**
</span>    @method
      コンストラクタ
    @param {Canarium} _canarium
      オーナーのCanariumクラスインスタンス
    @private
     */

    function I2CAccessor(_canarium) {
      this._canarium = _canarium;
    }

    return I2CAccessor;

  })();

  return Canarium;

})();


<span id='Canarium-BaseComm'>/**
</span>@class Canarium.BaseComm
PERIDOT下位層通信クラス
@uses chrome.serial
 */

Canarium.BaseComm = (function() {

<span id='Canarium-BaseComm-property-connected'>  /**
</span>  @property {boolean}
    接続されているかどうか
   */
  BaseComm.prototype.connected = false;


<span id='Canarium-BaseComm-property-path'>  /**
</span>  @property {string}
    現在接続中のパス
   */

  BaseComm.prototype.path = null;


<span id='Canarium-BaseComm-property-bitrate'>  /**
</span>  @property {number}
    ビットレート(bps)
   */

  BaseComm.prototype.bitrate = 115200;


<span id='Canarium-BaseComm-property-_cid'>  /**
</span>  @private
  @property {number}
    シリアル接続ID
   */

  BaseComm.prototype._cid = null;


<span id='Canarium-BaseComm-property-_onReceive'>  /**
</span>  @private
  @property {Function}
    受信コールバック関数(thisバインド付き)
   */

  BaseComm.prototype._onReceive = null;


<span id='Canarium-BaseComm-property-_onReceiveError'>  /**
</span>  @private
  @property {Function}
    受信エラーコールバック関数(thisバインド付き)
   */

  BaseComm.prototype._onReceiveError = null;


<span id='Canarium-BaseComm-property-_rxQueue'>  /**
</span>  @private
  @property {Object[]}
    受信待ちキュー
   */

  BaseComm.prototype._rxQueue = null;


<span id='Canarium-BaseComm-property-_rxBuffers'>  /**
</span>  @private
  @property {ArrayBuffer[]}
    受信データバッファの配列
   */

  BaseComm.prototype._rxBuffers = null;


<span id='Canarium-BaseComm-property-_rxTotalLength'>  /**
</span>  @private
  @property {number}
    受信データの合計サイズ
   */

  BaseComm.prototype._rxTotalLength = null;


<span id='Canarium-BaseComm-static-method-enumerate'>  /**
</span>  @static
  @method
    接続対象デバイスを列挙する
    (PERIDOTでないデバイスも列挙される可能性があることに注意)
  @param {function(boolean,Object[]):void}  callback
    コールバック関数(配列の各要素は次のメンバを持つ)
  
    - name : UI向け名称(COMxxなど)
    - path : 内部管理向けパス
  @return {void}
   */

  BaseComm.enumerate = function(callback) {
    chrome.serial.getDevices(function(ports) {
      var devices, i, len1, port;
      devices = [];
      for (i = 0, len1 = ports.length; i &lt; len1; i++) {
        port = ports[i];
        devices.push({
          path: &quot;&quot; + port.path,
          name: &quot;&quot; + (port.displayName || port.path)
        });
      }
      return callback(true, devices);
    });
  };


<span id='Canarium-BaseComm-method-BaseComm'>  /**
</span>  @method
    コンストラクタ
   */

  function BaseComm() {
    this._onReceive = (function(_this) {
      return function(info) {
        return _this._onReceiveHandler(info);
      };
    })(this);
    this._onReceiveError = (function(_this) {
      return function(info) {
        return _this._onReceiveErrorHandler(info);
      };
    })(this);
  }


<span id='Canarium-BaseComm-method-connect'>  /**
</span>  @method
    ボードに接続する
  @param {string} path
    接続先パス(enumerateが返すpath)
  @param {function(boolean):void} callback
    コールバック関数
  @return {void}
   */

  BaseComm.prototype.connect = function(path, callback) {
    if (this.connected) {
      callback(false);
      return;
    }
    this.connected = true;
    this.path = null;
    chrome.serial.connect(path, {
      bitrate: this.bitrate
    }, (function(_this) {
      return function(connectionInfo) {

        /*
        Windows: 接続失敗時はundefinedでcallbackが呼ばれる @ chrome47
         */
        if (!connectionInfo) {
          _this.connected = false;
          return callback(false);
        }
        _this.path = &quot;&quot; + path;
        _this._cid = connectionInfo.connectionId;
        _this._rxQueue = [];
        _this._rxBuffers = [];
        _this._rxTotalLength = 0;
        chrome.serial.onReceive.addListener(_this._onReceive);
        chrome.serial.onReceiveError.addListener(_this._onReceiveError);
        return callback(true);
      };
    })(this));
  };


<span id='Canarium-BaseComm-method-disconnect'>  /**
</span>  @method
    ボードから切断する
  @param {function(boolean):void} callback
    コールバック関数
  @return {void}
   */

  BaseComm.prototype.disconnect = function(callback) {
    if (!this.connected) {
      callback(false);
      return;
    }
    chrome.serial.disconnect(this._cid, function(result) {
      if (!result) {
        return callback(false);
      }
      chrome.serial.onReceive.removeListener(this._onReceive);
      chrome.serial.onReceiveError.removeListener(this._onReceiveError);
      this.connected = false;
      this.path = null;
      this._cid = null;
      this._rxQueue = null;
      this._rxBuffers = null;
      this._rxTotalLength = null;
      return callback(true);
    });
  };


<span id='Canarium-BaseComm-method-transCommand'>  /**
</span>  @method
    制御コマンドの送受信を行う
  @param {number} command
    コマンドバイト
  @param {function(boolean,number):void}  callback
    コールバック関数
  @return {void}
   */

  BaseComm.prototype.transCommand = function(command, callback) {
    var txarray;
    txarray = new Uint8Array(2);
    txarray[0] = 0x3a;
    txarray[1] = command;
    this._transSerial(txarray.buffer, 1, function(result, rxdata) {
      var rxArray;
      if (!result) {
        return callback(false, null);
      }
      rxArray = new Uint8Array(rxdata);
      return callback(true, rxArray[0]);
    });
  };


<span id='Canarium-BaseComm-method-transData'>  /**
</span>  @method
    データの送受信を行う
  @param {ArrayBuffer/null} txdata
    送信するデータ(制御バイトは自動的にエスケープされる。nullの場合は受信のみ)
  @param {number} rxsize
    受信するバイト数
  @param {function(boolean,ArrayBuffer):void} callback
    コールバック関数
  @return {void}
   */

  BaseComm.prototype.transData = function(txdata, rxsize, callback) {
    var byte, dst, i, len, len1, src;
    if (txdata) {
      src = new Uint8Array(txdata);
      dst = new Uint8Array(txdata.byteLength * 2);
      len = 0;
      for (i = 0, len1 = src.length; i &lt; len1; i++) {
        byte = src[i];
        if (byte === 0x3a || byte === 0x3d) {
          dst[len] = 0x3d;
          len += 1;
          byte ^= 0x20;
        }
        dst[len] = byte;
        len += 1;
      }
      txdata = dst.buffer.slice(0, len);
    }
    this._transSerial(txdata, rxsize, callback);
  };


<span id='Canarium-BaseComm-method-_transSerial'>  /**
</span>  @private
  @method
    シリアル通信の送受信を行う
  @param {ArrayBuffer/null} txdata
    送信するデータ(nullの場合は受信のみ)
  @param {number} rxsize
    受信するバイト数
  @param {function(boolean,ArrayBuffer):void} callback
    コールバック関数
  @return {void}
   */

  BaseComm.prototype._transSerial = function(txdata, rxsize, callback) {
    if (!this.connected) {
      callback(false, null);
      return;
    }
    this._rxQueue.push({
      length: rxsize,
      callback: callback
    });
    chrome.serial.send(this._cid, txdata, function() {
      return null;
    });
  };


<span id='Canarium-BaseComm-method-_onReceiveHandler'>  /**
</span>  @private
  @method
    シリアル受信時の処理を行う
  @param {Object} info
    受信情報
  @param {number} info.connectionId
    接続ID
  @param {ArrayBuffer} info.data
    受信データ
  @return {void}
   */

  BaseComm.prototype._onReceiveHandler = function(info) {
    var buffer, length, queue;
    if (!(info.connectionId === this._cid &amp;&amp; this.connected)) {
      return;
    }
    this._addRxBuffer(info.data);
    while (this._rxQueue.length &gt; 0) {
      length = this._rxQueue[0].length;
      if (length &gt; this._rxTotalLength) {
        break;
      }
      queue = this._rxQueue.shift();
      buffer = this._sliceRxBuffer(length);
      queue.callback.call(void 0, true, buffer);
    }
  };


<span id='Canarium-BaseComm-method-_addRxBuffer'>  /**
</span>  @private
  @method
    受信データバッファの末尾にデータを追加する
  @param {ArrayBuffer} data
    受信データ
  @return {void}
   */

  BaseComm.prototype._addRxBuffer = function(data) {
    this._rxBuffers.push(data.slice(0));
    this._rxTotalLength += data.byteLength;
  };


<span id='Canarium-BaseComm-method-_sliceRxBuffer'>  /**
</span>  @private
  @method
    受信データバッファの先頭からデータを取り出す
  @param {number} length
    取り出すバイト数
  @return {ArrayBuffer}
    取り出したデータ
   */

  BaseComm.prototype._sliceRxBuffer = function(length) {
    var array, partBuf, partLen, pos, rem;
    array = new Uint8Array(length);
    pos = 0;
    rem = length;
    while (rem &gt; 0) {
      partBuf = this._rxBuffers[0];
      partLen = partBuf.byteLength;
      if (partLen &lt;= rem) {
        this._rxBuffers.shift();
      } else {
        array = new Uint8Array(partLen - rem);
        array.set(new Uint8Array(partBuf, rem));
        this._rxBuffers[0] = array.buffer;
        partLen = rem;
      }
      array.set(new Uint8Array(partBuf, 0, partLen), pos);
      pos += partLen;
      rem -= partLen;
    }
    return array.buffer;
  };


<span id='Canarium-BaseComm-method-_onReceiveErrorHandler'>  /**
</span>  @private
  @method
    受信エラーハンドラ
  @param {Object} info
    エラー情報
  @param {number} info.connectionId
    接続ID
  @param {&quot;disconnected&quot;/&quot;timeout&quot;/&quot;device_lost&quot;/&quot;break&quot;/
          &quot;frame_error&quot;/&quot;overrun&quot;/&quot;buffer_overflow&quot;/
          &quot;parity_error&quot;/&quot;system_error&quot;} info.error
    エラー種別を示す文字列
  @return {void}
   */

  BaseComm.prototype._onReceiveErrorHandler = function(info) {
    var i, len1, q, ref;
    if (!(info.connectionId === this._cid &amp;&amp; this.connected)) {
      return;
    }
    this._rxBuffers = [];
    this._rxTotalLength = 0;
    ref = this._rxQueue;
    for (i = 0, len1 = ref.length; i &lt; len1; i++) {
      q = ref[i];
      q.callback.call(void 0, false, null);
    }
    this.disconnect(function() {});
  };

  return BaseComm;

})();
</pre>
</body>
</html>
